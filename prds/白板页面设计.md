# 白板页面设计（首页）

**状态**: 🟡 草稿
**创建日期**: 2026-01-15
**负责人**: AI + 用户
**版本**: v0.1

---

## 1. 页面概述

白板页面是 AI白板 的核心页面，用户打开网站后直接进入此页面。页面采用**三区域布局**：顶部导航栏、中间白板画布、右侧 AI 助手面板。

### 1.1 设计理念
- **AI 优先**: 右侧 AI 聊天框是核心差异化功能
- **打开即用**: 无需登录即可开始绘图和使用 AI
- **简洁高效**: 界面元素最小化，聚焦创作

---

## 2. 页面布局

### 2.1 整体布局（三区域）

```
┌──────────────────────────────────────────────────────────────────┐
│  [Logo] AI白板  |  [新建] [保存] [导出]  |  [关于] [登录]       │ ← 顶部导航栏（高度 60px）
├──────────────────────────────────────────┬───────────────────────┤
│                                          │  ╔════════════════╗  │
│                                          │  ║   AI 助手      ║  │
│                                          │  ╚════════════════╝  │
│                                          │  ┌────────────────┐  │
│            白板画布区域                   │  │  用户: 帮我画  │  │
│         (Excalidraw 组件)                │  │  一个流程图    │  │
│                                          │  ├────────────────┤  │ ← 右侧 AI 聊天面板
│                                          │  │  AI: 好的，请  │  │   (宽度 320px，可折叠)
│                                          │  │  告诉我...     │  │
│                                          │  └────────────────┘  │
│                                          │  [输入框]  [发送]   │
│                                          │  [收起] ←→          │
└──────────────────────────────────────────┴───────────────────────┘
```

### 2.2 响应式设计
- **桌面端** (>= 1024px): 三列布局，AI 面板默认展开
- **平板端** (768px - 1023px): AI 面板默认收起，可浮窗展开
- **移动端** (< 768px): AI 面板全屏模态框，点击按钮唤起

---

## 3. 顶部导航栏设计

### 3.1 布局结构

```
┌──────────────────────────────────────────────────────────────────┐
│ [Logo] AI白板  |  [新建] [保存] [导出] [分享]  |  [关于] [登录] │
└──────────────────────────────────────────────────────────────────┘
   ↑              ↑                                ↑
  左侧区         中间区（文件操作）              右侧区（用户）
```

### 3.2 功能区域

#### 左侧区：品牌标识
- **Logo + 产品名称**: "AI白板"
- 点击 Logo 返回首页（新建白板）
- 尺寸：约 180px

#### 中间区：文件操作
| 按钮 | 功能 | 说明 | 优先级 |
|------|------|------|--------|
| 新建 | 创建新白板 | 清空画布，重新开始 | P0 |
| 保存 | 保存当前白板 | 游客模式提示登录，登录后自动保存 | P0 |
| 导出 | 导出为图片/JSON | PNG、SVG、JSON 格式 | P0 |
| 分享 | 生成分享链接 | 生成只读链接，可设置权限 | P1 |
| 历史 | 查看版本历史 | 查看和恢复历史版本 | P2 |

#### 右侧区：用户相关
| 按钮 | 功能 | 说明 | 优先级 |
|------|------|------|--------|
| 关于 | 产品介绍 | 模态框或侧边栏显示产品信息 | P1 |
| 示例 | 查看示例白板 | 展示 AI 功能的示例作品 | P2 |
| 登录 | 用户登录/注册 | 显示用户头像（已登录）或登录按钮 | P0 |

### 3.3 视觉设计
- **背景色**: 白色/浅灰 (#FFFFFF / #F5F5F5)
- **分割线**: 底部 1px 边框 (#E0E0E0)
- **按钮样式**: 扁平设计，主按钮强调色，次按钮灰色
- **高度**: 60px（固定）

---

## 4. 白板画布区域设计

### 4.1 核心功能

基于 Excalidraw 的完整白板能力：

#### 基础绘图工具
- ✏️ **手绘工具**: 自由绘制线条
- □ **矩形**: 绘制矩形、圆角矩形
- ○ **圆形**: 绘制圆形、椭圆
- → **箭头**: 单向、双向箭头
- ━ **直线**: 直线、折线
- A **文本**: 文本框，支持富文本
- 🖼️ **图片**: 上传或粘贴图片
- 📦 **选择**: 选择、移动、缩放、旋转

#### 高级功能
- 📚 **素材库**: Excalidraw 官方素材库（图标、图形）
- 🎨 **样式**: 颜色、描边、填充、字体
- 📐 **对齐**: 智能对齐、分布、组合
- 🔒 **图层**: 图层顺序、锁定、隐藏
- ↩️ **撤销/重做**: 无限历史记录
- 🔍 **缩放**: 缩放、平移、适应画布

### 4.2 工具栏位置
- **左侧工具栏**: 绘图工具（Excalidraw 默认）
- **顶部属性栏**: 当前选中元素的属性（颜色、字体等）
- **右侧素材库**: 图标和图形素材（可折叠）

### 4.3 画布交互
- **无限画布**: 可无限扩展，支持平移和缩放
- **多选**: 框选、Shift 多选、Ctrl/Cmd 多选
- **快捷键**: 支持常用快捷键（Ctrl+C、Ctrl+V、Delete 等）
- **触控**: 支持触摸屏手势（双指缩放、拖动）

### 4.4 实时协作（P1，后续实现）
- 多用户光标显示
- 实时同步编辑
- 用户在线状态

---

## 5. 右侧 AI 助手面板设计 ⭐ 核心差异化

### 5.1 面板布局

```
╔═══════════════════════════════════╗
║  🤖 AI 助手               [收起] ║ ← 标题栏
╠═══════════════════════════════════╣
║  ┌─ 快捷功能 ──────────────────┐ ║
║  │ [生成流程图] [优化布局]     │ ║ ← 快捷按钮（可选）
║  │ [配色建议] [总结内容]       │ ║
║  └──────────────────────────────┘ ║
╠═══════════════════════════════════╣
║  聊天历史区域                     ║
║  ┌────────────────────────────┐  ║
║  │ 👤 用户: 帮我画一个登录流程│  ║
║  ├────────────────────────────┤  ║
║  │ 🤖 AI: 好的！我可以帮你创建│  ║ ← 聊天消息区
║  │ 一个登录流程图。请问需要包│  ║   (可滚动)
║  │ 含哪些步骤？                │  ║
║  │   [生成基础版] [详细说明]  │  ║
║  ├────────────────────────────┤  ║
║  │ 👤 用户: 包含手机号登录、  │  ║
║  │ 微信登录和邮箱登录          │  ║
║  └────────────────────────────┘  ║
╠═══════════════════════════════════╣
║  ┌──────────────────┬─────────┐  ║
║  │ 输入框...         │ [发送]  │  ║ ← 输入区
║  └──────────────────┴─────────┘  ║
║  [清空对话] [导出对话]            ║ ← 操作按钮
╚═══════════════════════════════════╝
```

### 5.2 面板尺寸
- **默认宽度**: 320px
- **最小宽度**: 280px（窄屏）
- **最大宽度**: 400px（宽屏）
- **高度**: 100vh - 60px（顶栏高度）
- **可拖拽调整**: 支持水平拖拽调整宽度
- **可折叠**: 点击"收起"按钮折叠到右侧边缘

### 5.3 AI 助手核心功能

#### 5.3.1 自然语言生成内容

**用户输入示例**:
- "帮我画一个用户注册流程图"
- "生成一个组织架构图，包含CEO、CTO、产品部、技术部"
- "创建一个思维导图，主题是产品规划"
- "画一个简单的网站架构图"

**AI 处理流程**:
```
用户输入 → AI 理解意图 → 生成白板元素 → 在画布中渲染
         ↓
      确认对话框（可选）
      "我将创建一个包含X个步骤的流程图，是否继续？"
      [确认] [修改需求]
```

**生成方式**:
- **直接生成**: AI 直接在画布中创建图形和连线
- **交互式生成**: AI 先询问细节，再生成
- **增量生成**: 用户可以要求"添加一个步骤"、"修改这个节点"

#### 5.3.2 AI 能力列表（MVP）

| 功能 | 描述 | 优先级 | 示例指令 |
|------|------|--------|----------|
| **生成流程图** | 根据描述生成流程图 | P0 | "画一个用户登录流程" |
| **生成思维导图** | 根据主题生成思维导图 | P0 | "创建产品规划思维导图" |
| **生成组织架构** | 创建组织结构图 | P1 | "生成一个初创公司的组织架构" |
| **智能补全** | 自动补全未完成的图形 | P1 | "帮我完善这个流程图" |
| **布局优化** | 优化当前白板布局 | P1 | "优化布局，让图形更整齐" |
| **配色建议** | 提供配色方案 | P2 | "给流程图换个配色" |
| **内容总结** | 总结白板内容为文字 | P2 | "总结这个白板的内容" |
| **转换格式** | 转换图形类型 | P2 | "把这些矩形转成圆形" |

#### 5.3.3 快捷功能按钮（可选）

在聊天区域顶部提供常用功能快捷按钮：

```
┌─ 快捷功能 ───────────────────────────┐
│ [📊 生成流程图] [🧠 生成思维导图]    │
│ [🏢 组织架构图] [🎨 优化布局]        │
│ [💡 配色建议]   [📝 总结内容]        │
└──────────────────────────────────────┘
```

点击按钮后：
- 直接触发对应功能（如果不需要参数）
- 或在输入框填充提示词（需要用户补充细节）

### 5.4 聊天交互设计

#### 5.4.1 消息类型

**用户消息**:
```
┌─ 👤 用户 ──────────────────────┐
│ 帮我画一个登录流程图            │
│ 2026-01-15 14:30               │
└────────────────────────────────┘
```

**AI 消息**:
```
┌─ 🤖 AI 助手 ───────────────────┐
│ 好的！我将为你创建一个登录流程  │
│ 图。请问需要包含以下哪些方式？  │
│                                 │
│ • 手机号登录                    │
│ • 邮箱登录                      │
│ • 第三方登录（微信、支付宝）    │
│                                 │
│ [生成基础版] [我来说明]         │
│ 2026-01-15 14:30               │
└────────────────────────────────┘
```

**系统消息**（操作反馈）:
```
┌─ ⚙️ 系统 ──────────────────────┐
│ ✅ 已在画布中生成流程图（5个节点）│
│ 2026-01-15 14:31               │
└────────────────────────────────┘
```

#### 5.4.2 交互模式

**快速模式**（默认）:
- AI 根据用户意图直接生成内容
- 适合明确的需求

**引导模式**:
- AI 先询问细节，再生成
- 适合复杂或模糊的需求

**协作模式**:
- AI 生成初稿，用户修改，AI 继续优化
- 多轮对话完善结果

#### 5.4.3 上下文理解

AI 需要理解：
- **画布状态**: 当前画布上有什么内容
- **选中元素**: 用户选中了哪些图形
- **对话历史**: 之前的对话内容
- **用户意图**: 是新建、修改还是优化

**示例对话**:
```
用户: 帮我画一个流程图
AI: 好的，请描述流程步骤

用户: 用户登录 → 验证 → 跳转首页
AI: [生成流程图]
    ✅ 已生成 3 个步骤的流程图

用户: 在验证后加一个"失败"的分支
AI: 好的，我将添加失败分支
    [在"验证"节点下添加"失败"路径]
    ✅ 已添加失败分支
```

### 5.5 AI 生成的可视化反馈

#### 5.5.1 生成中状态

```
┌─ 🤖 AI 助手 ───────────────────┐
│ 🔄 正在生成流程图...           │
│ ████████░░░░ 60%               │
└────────────────────────────────┘
```

#### 5.5.2 生成完成反馈

```
┌─ 🤖 AI 助手 ───────────────────┐
│ ✅ 已生成流程图！               │
│                                 │
│ 📊 包含内容:                    │
│ • 5 个节点                      │
│ • 6 条连线                      │
│ • 2 个决策点                    │
│                                 │
│ 你可以继续问我:                 │
│ • "优化布局"                    │
│ • "添加更多步骤"                │
│ • "修改颜色"                    │
└────────────────────────────────┘
```

#### 5.5.3 错误处理

```
┌─ 🤖 AI 助手 ───────────────────┐
│ ⚠️ 抱歉，我没理解你的意思       │
│                                 │
│ 你可以试试:                     │
│ • "生成一个流程图"              │
│ • "创建思维导图"                │
│ • "优化当前布局"                │
└────────────────────────────────┘
```

### 5.6 面板状态管理

#### 5.6.1 展开/收起状态

**展开状态** (默认):
- AI 面板占据右侧 320px
- 白板画布区域自适应

**收起状态**:
- AI 面板折叠到右侧边缘（40px）
- 仅显示垂直的"AI 助手"标签和展开按钮
- 白板画布区域扩大

**折叠动画**:
- 滑动动画（300ms ease-in-out）
- 白板画布平滑调整大小

#### 5.6.2 初始状态

**首次访问**:
- AI 面板默认展开
- 显示欢迎消息和功能介绍

**再次访问**:
- 记住用户的折叠状态（localStorage）
- 保留聊天历史（可选）

### 5.7 移动端适配

**移动端 (< 768px)**:
- AI 面板收起，显示浮动按钮（右下角）
- 点击按钮全屏显示 AI 对话框
- 对话框可滑动关闭

---

## 6. 核心交互流程

### 6.1 首次访问流程

```
用户打开网站
    ↓
首页白板页面（空白画布）
    ↓
Onboarding 提示（可跳过）
"👋 欢迎使用 AI白板！
 • 你可以直接在画布上绘图
 • 或者在右侧 AI 助手中输入需求
 • 试试对 AI 说：'帮我画一个流程图'"
    ↓
用户开始绘图 或 使用 AI
```

### 6.2 使用 AI 生成内容流程

```
用户在 AI 面板输入需求
    ↓
AI 解析意图
    ↓
┌───────────────┬───────────────┐
│ 需求明确      │ 需求模糊      │
└───────┬───────┴───────┬───────┘
        ↓               ↓
   直接生成        询问细节
        ↓               ↓
   渲染到画布      用户补充 → 生成
        ↓               ↓
   显示成功反馈    渲染到画布
```

### 6.3 修改 AI 生成内容流程

```
用户选中 AI 生成的图形
    ↓
对 AI 说："把这个节点改成圆形"
    ↓
AI 识别选中元素 + 理解修改需求
    ↓
执行修改
    ↓
显示反馈："✅ 已修改为圆形"
```

### 6.4 保存和分享流程

```
用户点击"保存"
    ↓
┌─────────────┬──────────────┐
│ 已登录      │ 游客模式     │
└─────┬───────┴──────┬───────┘
      ↓              ↓
  自动保存      提示登录
      ↓              ↓
  ✅ 保存成功   用户登录 → 保存
```

---

## 7. 技术实现要点

### 7.1 前端技术栈

- **框架**: Vite + React + TypeScript
- **白板**: @excalidraw/excalidraw
- **状态管理**: Zustand（轻量）或 Redux Toolkit
- **UI 组件**: Tailwind CSS + Headless UI
- **AI 通信**: WebSocket 或 Server-Sent Events（实时流式输出）

### 7.2 AI 集成架构

```
前端 AI 面板
    ↓ (WebSocket / SSE)
后端 AI 服务
    ↓
大模型 API (GPT-4 / Claude / 自建)
    ↓
解析结果 → JSON 格式
    ↓
前端渲染到 Excalidraw
```

**数据格式示例**:
```json
{
  "action": "create_flowchart",
  "elements": [
    {
      "type": "rectangle",
      "text": "用户登录",
      "position": { "x": 100, "y": 100 },
      "size": { "width": 120, "height": 60 }
    },
    {
      "type": "arrow",
      "from": "element-1",
      "to": "element-2"
    }
  ]
}
```

### 7.3 AI 面板状态管理

```typescript
interface AIChatState {
  messages: ChatMessage[];
  isLoading: boolean;
  isPanelOpen: boolean;
  panelWidth: number;
}

interface ChatMessage {
  id: string;
  role: 'user' | 'assistant' | 'system';
  content: string;
  timestamp: Date;
  relatedElements?: string[]; // 关联的画布元素 ID
}
```

---

## 8. 视觉设计规范

### 8.1 色彩系统

- **主色**: #6366F1（Indigo，用于按钮、强调）
- **辅色**: #8B5CF6（Purple，用于 AI 相关）
- **成功色**: #10B981（Green）
- **警告色**: #F59E0B（Amber）
- **错误色**: #EF4444（Red）
- **中性色**: #6B7280（Gray）

### 8.2 字体

- **标题**: Inter / PingFang SC（苹方）
- **正文**: Inter / PingFang SC
- **代码**: JetBrains Mono

### 8.3 间距

- **小间距**: 8px
- **中间距**: 16px
- **大间距**: 24px
- **超大间距**: 32px

---

## 9. MVP 优先级

### 9.1 P0 功能（必须有）

**顶部导航栏**:
- ✅ Logo + 产品名
- ✅ 新建、保存、导出按钮
- ✅ 登录按钮

**白板画布**:
- ✅ 完整 Excalidraw 功能
- ✅ 自动保存到 localStorage

**AI 助手面板**:
- ✅ 基础聊天界面
- ✅ 生成流程图功能
- ✅ 生成思维导图功能
- ✅ 折叠/展开功能

### 9.2 P1 功能（应该有）

- 分享功能
- 快捷功能按钮
- 智能布局优化
- 聊天历史保存

### 9.3 P2 功能（可以有）

- 版本历史
- 示例白板
- 配色建议
- 导出对话记录

---

## 10. 用户场景示例

### 场景 1: 产品经理画流程图

```
1. 打开 AI白板
2. 对 AI 说："帮我画一个用户注册流程"
3. AI 询问："需要包含哪些步骤？"
4. 用户回复："手机号注册、验证码验证、设置密码、完成"
5. AI 生成流程图（4个步骤 + 箭头连接）
6. 用户手动调整位置、添加备注
7. 点击"保存"
```

### 场景 2: 团队协作

```
1. 用户 A 创建白板，开始绘制架构图
2. 对 AI 说："生成一个微服务架构图"
3. AI 生成基础架构
4. 用户 A 手动完善细节
5. 点击"分享"，生成链接
6. 用户 B 打开链接，实时查看/编辑（P1）
```

### 场景 3: 学生做笔记

```
1. 打开 AI白板
2. 对 AI 说："创建一个关于'数据库设计'的思维导图"
3. AI 生成思维导图框架
4. 学生手动添加自己的笔记和理解
5. 导出为图片，保存到本地
```

---

## 11. 待讨论问题

1. **AI 生成的准确性**: 如何保证 AI 生成的图形符合用户预期？
2. **AI 调用成本**: 如何控制 AI API 调用成本？（缓存、限流）
3. **用户引导**: 如何让用户快速学会使用 AI 功能？
4. **错误处理**: AI 理解错误或生成失败时的降级方案
5. **多轮对话**: 如何保持对话上下文，支持复杂需求？

---

## 12. 下一步行动

- [ ] 确定 AI 模型选择（GPT-4 / Claude / 自建）
- [ ] 设计 AI Prompt 模板（流程图、思维导图等）
- [ ] 设计 AI 生成结果的数据格式（JSON Schema）
- [ ] 绘制高保真设计稿（Figma）
- [ ] 开发前端白板页面原型
- [ ] 开发 AI 聊天面板组件
- [ ] 集成 AI API
- [ ] 测试 AI 生成效果

---

## 13. 附录

### 13.1 参考竞品

- **Miro AI**: 右侧面板，AI 生成便签、总结
- **Figma AI**: 底部浮窗，AI 生成设计元素
- **ChatGPT**: 聊天界面参考

### 13.2 相关文档

- [产品概述](./产品概述.md)
- [Excalidraw 集成方案](../docs/Excalidraw集成方案.md)
- [开发流程规范](../.claude/context/development-workflow.md)

### 13.3 更新记录

- 2026-01-15: 创建白板页面设计文档（v0.1）

---

## 讨论区

**用户反馈**:
- 右侧聊天框是核心亮点，需要重点打磨体验
- AI 生成功能需要快速准确，否则用户会放弃使用

**技术挑战**:
- 如何将自然语言转换为精确的白板元素？
- 如何处理复杂的多轮对话？
- 如何优化 AI 调用延迟？
