# 架构设计

> 当前状态：初步设计中

## 系统架构概览

### 整体架构
```
┌─────────────────────────────────────────────────┐
│                  用户浏览器                      │
│  ┌─────────────────────────────────────────┐   │
│  │  前端应用 (React SPA)                    │   │
│  │  - Vite + React + TypeScript             │   │
│  │  - Tailwind CSS + shadcn/ui              │   │
│  │  - React Router                          │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
           │                    │
           │ HTTP/WebSocket     │ HTTP
           ▼                    ▼
┌──────────────────┐    ┌──────────────────┐
│   后端 API        │    │   AI 服务         │
│  (待定义)         │    │  (待定义)         │
│                  │    │                  │
└──────────────────┘    └──────────────────┘
           │
           ▼
┌──────────────────┐
│   数据库          │
│  (待定义)         │
│                  │
└──────────────────┘
```

## 前端架构

### 技术栈
- **构建工具**: Vite 7.x
- **框架**: React 19.2.3 + TypeScript 5.9.3
- **路由**: React Router 7.12.0
- **样式**: Tailwind CSS v4 + shadcn/ui
- **状态管理**: 待按需引入（规划 Zustand）

### 目录结构
```
packages/web/
├── index.html              # 入口 HTML
├── vite.config.ts          # Vite 配置
├── tailwind.config.js      # Tailwind 配置
├── tsconfig.json           # TypeScript 配置
├── src/
│   ├── main.tsx           # 应用入口
│   ├── App.tsx            # 根组件（路由配置）
│   ├── lib/               # 工具函数
│   │   └── utils.ts       # className 合并等工具
│   ├── pages/             # 页面组件
│   │   └── Board.tsx      # 白板页面
│   ├── components/        # UI 组件（待添加）
│   ├── hooks/             # 自定义 Hooks（待添加）
│   └── api/               # API 调用（待添加）
└── ...
```

### 页面布局架构
```
┌─────────────────────────────────────────────┐
│ Header (h-14)                               │
│  [Logo] AI白板  [标题输入]  [分享按钮]       │
├─────────────────────────────────────────────┤
│ Main Content (flex-1)                       │
│  ┌──────────────────┬────────────────────┐ │
│  │                  │                    │ │
│  │  Canvas Area     │  AI Panel (w-80)   │ │
│  │  (flex-1)        │                    │ │
│  │                  │  - 标题栏 (h-14)   │ │
│  │  Excalidraw      │  - 聊天内容区      │ │
│  │                  │  - 输入框          │ │
│  │                  │                    │ │
│  └──────────────────┴────────────────────┘ │
└─────────────────────────────────────────────┘
```

### 路由设计（MVP）
- `/` - 主页面（白板）
- `/board/:id` - 分享的白板（后续实现）

### 设计原则
- **极简导航**：顶部栏占用最小空间（56px）
- **打开即用**：无需登录即可开始绘图（游客模式）
- **渐进式功能**：核心功能优先，高级功能按需加载

## 后端架构

### 技术栈（待定义）
- **框架**: Express / Fastify / NestJS
- **API 风格**: RESTful / GraphQL / tRPC
- **数据库**: 待定义
- **实时协作**: WebSocket / Socket.io

## 白板集成架构

### Excalidraw 集成方案
- **包**: @excalidraw/excalidraw
- **集成方式**: React 组件
- **主题**: 适配 shadcn/ui 主题系统
- **AI 集成点**:
  - onChange 监听（获取画布数据）
  - 自定义 UI（添加 AI 按钮）
  - API 注入（AI 生成元素）

## 数据流

### 用户绘图流程
```
用户操作
  ↓
Excalidraw onChange
  ↓
本地状态更新
  ↓
WebSocket 广播（实时协作）
  ↓
后端保存（定期）
```

### AI 辅助流程（规划中）
```
用户输入 Prompt
  ↓
前端发送 API 请求
  ↓
后端调用 AI 模型
  ↓
AI 返回生成数据（JSON）
  ↓
前端解析并渲染到 Excalidraw
```

## 模块划分

### 前端模块
- **白板模块**：Excalidraw 集成和操作
- **AI 模块**：AI 聊天和生成功能
- **协作模块**：实时同步和多人协作（待实现）
- **用户模块**：登录、注册、个人中心（待实现）

### 后端模块（待定义）
- **API 模块**：RESTful API
- **AI 模块**：AI 模型调用和数据处理
- **协作模块**：WebSocket 实时通信
- **存储模块**：白板数据存储和管理

## 关键设计决策
参考 [decisions](../decisions/) 目录：
- ADR 001：包管理器选择 - pnpm
- ADR 002：构建工具选择 - Turborepo
- ADR 003：Git 提交规范
- ADR 004：白板框架选择 - Excalidraw
- ADR 005：前端渲染方案 - CSR (Vite + React)
- ADR 006：UI 框架选择 - Tailwind CSS + shadcn/ui

## 更新记录
- 2026-01-14: 创建架构文档
- 2026-01-16: 补充前端架构设计（Vite + React + Tailwind + shadcn/ui）
- 2026-01-16: 补充页面布局架构和路由设计
