# ADR 001: 选择 pnpm 作为包管理器

## 状态
✅ 已接受 (2026-01-14)

## 背景
项目采用 Monorepo 架构管理前后端代码，需要选择合适的包管理器。候选方案包括：
- npm (Node.js 官方)
- pnpm (性能优化版本)
- bun (新一代运行时 + 包管理器)

## 决策
选择 **pnpm** 作为项目的包管理器。

## 理由

### 为什么选择 pnpm？
1. **Monorepo 原生支持**
   - pnpm-workspace.yaml 配置简洁直观
   - 跨包依赖管理优秀
   - 被 Turborepo、Nx 等 Monorepo 工具推荐

2. **性能优异**
   - 安装速度比 npm 快 2-3 倍
   - 使用硬链接和符号链接，所有项目共享依赖
   - 大幅节省磁盘空间（数 GB 级别的节省）

3. **企业级验证**
   - Microsoft、ByteDance、Shopify 在生产环境使用
   - Vue 3、Vite 等知名项目采用
   - 社区活跃，问题解决方案丰富

4. **学习成本低**
   - 命令与 npm 几乎完全一致
   - 团队成员可无缝切换
   - 文档完善，迁移简单

5. **依赖管理严格**
   - 避免幽灵依赖（phantom dependencies）
   - 每个包只能访问声明的依赖
   - 提高代码质量和可维护性

### 为什么不选 npm？
- 安装速度较慢
- 磁盘空间占用大（每个项目独立 node_modules）
- Monorepo 管理功能相对基础

### 为什么不选 bun？
- 生态不够成熟（2021 年发布，较新）
- 部分 npm 包可能存在兼容性问题
- 生产环境案例较少，风险较高
- 虽然性能最强，但稳定性是项目首要考量

## 影响

### 积极影响
- 开发体验提升（安装快、占用少）
- Monorepo 管理更高效
- 长期维护成本降低

### 需要注意
- 团队成员需全局安装 pnpm: `npm install -g pnpm`
- CI/CD 流程需配置 pnpm 环境
- 极少数老旧包可能有兼容性问题（遇到再处理）

## 相关文档
- [技术选型.md](../../../docs/技术选型.md#推荐方案) - 详细对比分析
- [tech-stack.md](../context/tech-stack.md) - 技术栈概览

## 参与者
- Vincent (项目负责人)
- Claude Code (AI 辅助开发)
